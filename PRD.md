# 图片水印本地应用产品需求文档（PRD）

## 1. 产品概述

本产品是一款运行在MacOS上的图片水印工具，旨在为用户提供便捷、高效的图片水印添加功能。用户可以通过简单的操作，为单张或批量图片添加文本或图片水印，并自定义水印的样式、位置、透明度等属性，最终导出带有水印的图片文件。

## 2. 系统架构

- 开发语言：Python（使用PyQt或Tkinter构建GUI界面，PIL/Pillow库处理图片）
- 运行环境：MacOS 10.14及以上版本
- 不依赖网络连接，完全本地运行

## 3. 功能需求

### 3.1 文件处理

#### 3.1.1 导入图片
- 支持单张图片拖拽或通过文件选择器导入
- 支持批量导入，可一次性选择多张图片或直接导入整个文件夹
- 在界面上显示已导入图片的列表（缩略图和文件名）

#### 3.1.2 支持格式
- 输入格式：必须支持主流格式，如JPEG, PNG。强烈建议支持BMP, TIFF。PNG格式必须支持透明通道
- 输出格式：用户可选择输出为JPEG或PNG

#### 3.1.3 导出图片
- 用户可指定一个输出文件夹。为防止覆盖原图，默认禁止导出到原文件夹
- 提供导出文件命名规则选项：
  - 保留原文件名
  - 添加自定义前缀（如wm_）
  - 添加自定义后缀（如_watermarked）
- 对于JPEG格式，提供图片质量（压缩率）调节滑块（0-100）（可选高级功能）
- 导出时允许用户调整图片尺寸（如按宽度、高度或百分比缩放）（可选高级功能）

### 3.2 水印类型

#### 3.2.1 文本水印
- 内容：用户可自定义输入任意文本
- 字体：可选择系统已安装的字体、字号、粗体、斜体（可选高级功能）
- 颜色：提供调色板让用户选择字体颜色（可选高级功能）
- 透明度：可调节文本的透明度（0-100%）
- 样式：可添加阴影或描边效果，以增强在复杂背景下的可读性（可选高级功能）

#### 3.2.2 图片水印（可选高级功能）
- 用户可从本地选择一张图片（如Logo）作为水印
- 必须支持带透明通道的PNG图片
- 缩放：可按比例或自由调整图片水印的大小
- 透明度：可调节图片水印的整体透明度（0-100%）

### 3.3 水印布局与样式

#### 3.3.1 实时预览
- 所有对水印的调整都应在主预览窗口中实时显示效果
- 用户可以点击图片列表切换预览不同的图片

#### 3.3.2 位置
- 预设位置：提供九宫格布局（四角、正中心），用户可一键将水印放置在这些位置
- 手动拖拽：用户可以直接在预览图上通过鼠标拖拽水印到任意位置

#### 3.3.3 旋转
- 提供一个滑块或输入框，允许用户以任意角度旋转水印（可选高级功能）

### 3.4 配置管理

#### 3.4.1 水印模板
- 用户可以将当前的水印设置（包括水印内容、字体、颜色、位置、大小、透明度等所有参数）保存为一个模板
- 用户可以加载、管理和删除已保存的模板
- 程序启动时可自动加载上一次关闭时的设置或一个默认模板

## 4. 用户界面设计

### 4.1 主界面布局
- 左侧：已导入图片列表（显示缩略图和文件名）
- 中央：当前选中图片的预览区域，支持实时显示水印效果
- 右侧：水印设置面板，包含文本/图片水印选项、样式设置、位置调整等功能
- 底部：导入、导出按钮和进度显示

### 4.2 交互设计
- 拖拽操作：支持将图片拖拽到应用窗口进行导入
- 鼠标交互：在预览区域中支持拖拽调整水印位置
- 滑块控件：用于调整透明度、旋转角度、图片质量等参数
- 按钮控件：用于应用预设位置、保存/加载模板、导入/导出等操作

## 5. 技术实现要点

### 5.1 图片处理核心
- 使用PIL/Pillow库进行图片读写和处理
- 实现水印添加算法，支持文本和图片水印
- 处理PNG透明通道，确保水印效果符合预期

### 5.2 批量处理机制
- 实现多线程或异步处理，确保批量处理大文件时界面响应流畅
- 添加进度显示和取消功能

### 5.3 模板管理
- 使用JSON或SQLite存储模板配置
- 提供模板预览和快速应用功能

## 6. 性能要求

- 处理单张10MB以内的图片时，响应时间应小于1秒
- 批量处理10张图片时，总体处理时间应小于30秒
- 内存占用应控制在合理范围内，避免因处理大图片导致系统性能下降

## 7. 安全性要求

- 确保用户数据隐私，不收集或上传任何图片内容
- 防止误操作覆盖原文件，默认禁止导出到原文件夹
- 提供明确的错误提示和异常处理机制

## 8. 发布与维护

- 提供安装包或DMG文件，方便用户安装
- 保留用户配置和模板数据，确保升级后用户数据不丢失
- 提供基本的使用文档和常见问题解答
