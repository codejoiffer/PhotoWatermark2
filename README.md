# PhotoWatermark2
# PhotoWatermark2

## 项目概述

PhotoWatermark2是一款运行在MacOS上的图片水印工具，旨在为用户提供便捷、高效的图片水印添加功能。用户可以通过简单的操作，为单张或批量图片添加文本或图片水印，并自定义水印的样式、位置、透明度等属性，最终导出带有水印的图片文件。

## 功能特性

- **文件处理**：支持单张/批量图片导入、多种图片格式支持、自定义导出选项
- **水印类型**：支持文本水印和图片水印
- **水印样式**：可自定义字体、颜色、透明度、旋转角度等属性
- **实时预览**：所有调整实时显示效果
- **模板管理**：可保存和加载水印配置模板
- **支持中文**：完美支持中文字符显示和水印添加

## 技术栈

- **开发语言**：Python
- **GUI框架**：PyQt6
- **图片处理**：Pillow
- **运行环境**：MacOS 10.14及以上版本

## 项目结构

- `PRD.md`：产品需求文档
- `requirements.txt`：项目依赖库列表
- `README.md`：项目说明文档
- `src/`：源代码目录
  - `main.py`：主程序入口
  - `ui/`：界面相关代码
  - `core/`：核心功能实现
  - `utils/`：工具类和辅助函数
- `resources/`：资源文件目录
  - `fonts/`：中文字体目录
  - `icons/`：图标资源
- `run_app.sh`：启动脚本
- `check_fonts.py`：字体检查脚本
- `test_chinese_watermark.py`：中文水印测试脚本

## 如何运行

### 方法一：使用启动脚本

1. 确保您的系统已安装Python 3.7或更高版本
2. 安装项目依赖：
   ```
   pip install -r requirements.txt
   ```
3. 运行启动脚本：
   ```
   ./run_app.sh
   ```

### 方法二：直接运行

1. 确保您的系统已安装Python 3.7或更高版本
2. 安装项目依赖：
   ```
   pip install -r requirements.txt
   ```
3. 运行主程序：
   ```
   python src/main.py
   ```

## 字体管理与中文显示

PhotoWatermark2包含一个专门的字体管理系统，用于确保中文水印能够正确显示。

### 字体加载机制

应用程序使用`FontManager`类管理字体加载，它会按照以下优先级尝试加载字体：

1. 首先尝试从缓存中加载
2. 然后尝试从指定路径加载字体文件
3. 接着尝试从系统已安装的中文字体中加载
4. 最后尝试从`resources/fonts`目录加载

支持的中文字体包括：SimHei、WenQuanYi Micro Hei、Heiti TC、Arial Unicode MS、Microsoft YaHei、PingFang SC等。

### 字体目录

应用程序会在`resources/fonts`目录中查找中文字体文件。如果您遇到中文显示问题，可以将.ttf或.otf格式的中文字体文件放入此目录。

### 字体检查和测试

项目提供了两个辅助脚本来帮助排查字体问题：

#### 字体检查脚本

该脚本用于检查系统中是否安装了中文字体，并验证FontManager是否能正确加载这些字体。

```bash
python check_fonts.py
```

#### 中文水印测试脚本

该脚本用于测试中文水印显示功能，会生成带有中文水印的示例图片。

```bash
python test_chinese_watermark.py
```

测试结果将保存在`test_results`目录中，您可以查看这些图片以确认中文水印是否正确显示。

## 使用指南

### 基本操作流程

1. 点击"打开文件"按钮或拖拽图片到应用窗口，导入图片
2. 在右侧面板设置水印参数：
   - 文本水印：输入文本内容，选择字体、大小、颜色、透明度等
   - 图片水印：选择图片文件，设置透明度、缩放比例等
3. 选择水印位置（预设位置或手动拖拽）
4. 调整其他参数（旋转角度、阴影、描边等）
5. 点击"应用水印"按钮预览效果
6. 点击"保存"按钮导出带水印的图片

### 高级功能

#### 模板管理
- **保存模板**：设置好水印参数后，在"模板"菜单中选择"保存当前模板"，输入模板名称即可保存
- **加载模板**：在"模板"菜单中选择"加载模板"，选择已保存的模板即可快速应用

#### 批量处理
- 点击"批量处理"按钮，选择多个图片文件
- 设置水印参数
- 选择输出目录
- 点击"开始处理"按钮批量添加水印

## 常见问题解答

### Q: 为什么我的中文字体显示不正确？
A: 应用程序会自动尝试加载系统中可用的中文字体，包括SimHei、WenQuanYi Micro Hei、Heiti TC、Arial Unicode MS、Microsoft YaHei等。如果所有尝试都失败，会使用系统默认字体。确保您的系统已安装中文字体。您可以运行`python check_fonts.py`检查系统字体情况，也可以将.ttf格式的中文字体文件放入`resources/fonts`目录。

### Q: 如何测试中文水印是否能正确显示？
A: 您可以运行`python test_chinese_watermark.py`脚本，它会生成带有中文水印的示例图片并保存到`test_results`目录。

### Q: 我可以调整水印的位置吗？
A: 是的，您可以在预设位置中选择（左上、右上、左下、右下、居中），也可以在预览窗口中手动拖拽水印到任意位置。

### Q: 如何保存我的水印设置以供后续使用？
A: 您可以将当前的水印设置保存为模板。在"模板"菜单中选择"保存当前模板"，输入模板名称即可。下次使用时，选择"加载模板"即可快速应用相同的设置。

### Q: 应用程序支持哪些图片格式？
A: 支持的图片格式包括：.jpg、.jpeg、.png、.bmp、.tiff、.tif等常见格式。

### Q: 我的配置和模板保存在哪里？
A: 配置文件和模板保存在用户目录下的`~/Library/Application Support/PhotoWatermark2/`文件夹中。升级应用程序时，这些数据不会被删除，确保您的设置和模板在升级后仍然可用。

### Q: 如何调整输出图片的质量？
A: 您可以在输出设置中调整图片质量参数，范围为1-100，数值越高质量越好。

## 升级说明

当升级到新版本时，您的配置和模板数据将会被保留。新版本会自动识别并使用您已有的设置，无需重新配置。

## 联系与支持

如有任何问题或建议，请随时联系开发团队。
